(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(9275)}])},9275:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return E}});var n=a(5893),l=a(6611),t=a(7294),i=a(6010),r=a(765);function o(e){let{className:s,...a}=e;return(0,n.jsx)(r.zx,{className:(0,i.Z)("inline-flex text-sm outline-offset-2","font-semibold",s),...a})}var c=a(1782);function d(e){let{index:s,page:a,page_content:l,source:i}=e,[o,c]=(0,t.useState)(!1);var d=null==l?void 0:l.replace(/â†“/g,"\n");return(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"text-left pt-2  text-blue-600 hover:underline",onClick:()=>c(!0),children:["\uD83E\uDDE0 Source ",s,": ",i,"  - Page ",a]}),(0,n.jsxs)(r.u_,{show:o,onClose:()=>c(!1),children:[(0,n.jsxs)(r.u_.Header,{children:[i," - Page ",a]}),(0,n.jsx)(r.u_.Body,{children:(0,n.jsx)("div",{className:"space-y-6",children:(0,n.jsx)("p",{className:"text-base leading-relaxed text-gray-500 dark:text-gray-400",children:d})})})]})]},s)}var x=a(3854);let h=e=>(0,n.jsx)(c.Z,{...e}),m=()=>(0,n.jsx)("div",{className:"flex min-w-full animate-pulse px-4 py-5 sm:px-6",children:(0,n.jsx)("div",{className:"flex flex-grow space-x-3",children:(0,n.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,n.jsx)("p",{className:"font-large text-xxl text-gray-900",children:(0,n.jsx)("a",{href:"#",className:"hover:underline",children:"AI"})}),(0,n.jsxs)("div",{className:"space-y-4 pt-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,n.jsx)("div",{className:"col-span-2 h-2 rounded bg-zinc-500"}),(0,n.jsx)("div",{className:"col-span-1 h-2 rounded bg-zinc-500"})]}),(0,n.jsx)("div",{className:"h-2 rounded bg-zinc-500"})]})]})})}),u=e=>e.split("\n").map((e,s)=>(0,n.jsxs)("span",{children:[e,(0,n.jsx)("br",{})]},s));function g(e){let{who:s="bot",message:a,sources:l,isPlausible:t}=e;if(!a)return null;let r=u(a);return(0,n.jsx)("div",{className:"bot"!=s?"float-right clear-both":"float-left clear-both",children:(0,n.jsx)(h,{children:(0,n.jsx)("div",{className:"float-right mb-5 rounded-lg bg-white px-4 py-5 shadow-lg ring-1 ring-zinc-100 sm:px-6",children:(0,n.jsx)("div",{className:"flex space-x-3",children:(0,n.jsx)("div",{className:"flex-1 gap-4 flex flex-row",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-large text-xxl text-gray-900",children:(0,n.jsx)("a",{href:"#",className:"hover:underline",children:"bot"==s?"AI":"You"})}),!1===t&&(0,n.jsxs)("div",{className:"flex flex-row items-center text-orange-600 mb-6",children:[(0,n.jsx)(x.pYU,{className:"mr-2 h-5 w-5"}),"The AI believes it may have hallucinated this answer. Please make sure to verify with the original sources."]}),(0,n.jsx)("p",{className:(0,i.Z)("text ","bot"==s?"font-semibold font- ":"text-gray-400"),children:r}),l&&l.map((e,s)=>{let{page_content:a,metadata:l}=e,{page:t,source:i}=l;return(0,n.jsx)(d,{index:s+1,page:t,page_content:a,source:i},s)})]})})})})})})}var p=a(461),f=a(4303),j=a.n(f);let N=e=>{let{color:s="#000",style:a="small"}=e;return(0,n.jsx)("div",{className:"h-5 w-5",children:(0,n.jsxs)("span",{className:"small"==a?j().loading2:j().loading,children:[(0,n.jsx)("span",{style:{backgroundColor:s}}),(0,n.jsx)("span",{style:{backgroundColor:s}}),(0,n.jsx)("span",{style:{backgroundColor:s}})]})})};N.defaultProps={style:"small"};let b="ask-my-book-steamship",v=[{who:"bot",message:"Hi! Ask me any question about NEPA!"}],w=e=>{let{input:s,setInput:a,sendMessage:l,loading:t}=e;return(0,n.jsxs)("div",{className:"mt-6 flex clear-both",children:[(0,n.jsx)("input",{type:"text","aria-label":"chat input",required:!0,className:"min-w-0 flex-auto appearance-none rounded-md border border-zinc-900/10 bg-white px-3 py-[calc(theme(spacing.2)-1px)] shadow-md shadow-zinc-800/5 placeholder:text-zinc-400 focus:border-teal-500 focus:outline-none focus:ring-4 focus:ring-teal-500/10 sm:text-sm",value:s,onKeyDown:e=>{"Enter"===e.key&&(l(s),a(""))},onChange:e=>{a(e.target.value)}}),!t&&(0,n.jsx)(o,{type:"submit",gradientDuoTone:"greenToBlue",className:"ml-2 flex-none",onClick:e=>{l(s),a("")},children:(0,n.jsx)(x.mR2,{className:"h-5 w-5"})}),t&&(0,n.jsx)(o,{gradientDuoTone:"greenToBlue",className:"ml-2 h-20",disabled:!0,children:(0,n.jsx)(N,{color:"white",style:"large"})})]})};function y(e){let{baseUrl:s}=e,[a,l]=(0,t.useState)(v),[i,r]=(0,t.useState)(""),[c,d]=(0,t.useState)(Math.random().toString(36).substring(7)),[h,u]=(0,t.useState)(!1),[f,j]=(0,p.Z)([b]),[N,y]=(0,t.useState)(void 0);(0,t.useEffect)(()=>{f[b]||j(b,Math.random().toString(36).substring(7))},[f,j]);let _=()=>{d(Math.random().toString(36).substring(7))},k=()=>{_(),l(v)},T=()=>{let{who:e}=a[a.length-1],s=0;"bot"===e&&(s=1);let{message:n,who:l}=a[a.length-1-s];C(n,a.slice(0,a.length-1-s))},C=async(e,n)=>{u(!0),y(void 0);let t=[...n||a,{message:e,who:"user"}];l(t);let i=await fetch(s+"/answer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e,chat_session_id:c})});if(!i.ok){u(!1);let{status:e}=await i.json();y(e.statusMessage);return}let{answer:r,sources:o,is_plausible:d}=await i.json();u(!1),l(e=>[...e,{message:r.trim(),who:"bot",sources:o,isPlausible:d}])};return(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"rounded-2xl border-zinc-100  lg:border lg:p-6",children:[a.map((e,s)=>{let{message:a,who:l,sources:t,isPlausible:i}=e;return(0,n.jsx)(g,{who:l,message:a,sources:t,isPlausible:i},s)}),h&&(0,n.jsx)(m,{}),a.length<2?(0,n.jsx)("span",{className:"mx-auto flex flex-grow text-gray-600 clear-both",children:"Type a message to start the conversation"}):(0,n.jsxs)("span",{className:"justify-center content-center mx-auto flex flex-grow clear-both",children:[(0,n.jsx)(o,{disabled:h,outline:!0,onClick:T,gradientDuoTone:"greenToBlue",children:(0,n.jsxs)("div",{className:"flex flex-row items-center",children:[(0,n.jsx)(x.zHJ,{className:"mr-2 h-5 w-5"})," Regenerate response"]})}),(0,n.jsx)(o,{disabled:h,outline:!0,onClick:k,gradientDuoTone:"greenToBlue",className:"ml-2",children:(0,n.jsxs)("div",{className:"flex flex-row items-center",children:[(0,n.jsx)(x.r7I,{className:"mr-2 h-5 w-5"})," New chat"]})})]}),(0,n.jsx)(w,{input:i,setInput:r,sendMessage:C,loading:h}),N&&(0,n.jsx)("div",{className:"rounded-md bg-red-50 p-4",children:(0,n.jsx)("div",{className:"flex",children:(0,n.jsxs)("div",{className:"ml-3",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,n.jsx)("p",{children:N})]})})})]})})}var _=a(1163);function k(){let[e,s]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{let e=setTimeout(()=>s(!0),1e3);return()=>clearTimeout(e)},[]),(0,n.jsx)("div",{className:"spinnerContainer",children:e?(0,n.jsx)(r.$j,{className:"spinner"}):(0,n.jsx)("div",{className:"spinnerContainer"})})}function T(e){let{dbId:s}=e,[a,l]=(0,t.useState)(null),[i,o]=(0,t.useState)(!0),c=async()=>{try{o(!0);let e=await fetch("/api/books",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dbId:s})}),{books:a}=await e.json();l(a),console.log("Number of books",a.length)}catch(e){console.error(e)}finally{o(!1)}};return(0,t.useEffect)(()=>{c()},[]),(0,n.jsxs)("div",{children:[i&&(0,n.jsx)(k,{}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{marginTop:"16px",marginBottom:"16px"},children:"NEPAchat is a model trained on a diverse range of NEPA-related content, including AA, BB and CC information."}),(0,n.jsx)("div",{style:{marginBottom:"16px"},children:"The model has limitations and may experience delays during Q&A sessions, for which we apologize."})]}),a&&0===a.length&&(0,n.jsx)(r.bZ,{color:"failure",children:(0,n.jsx)("span",{children:(0,n.jsx)("span",{className:"font-medium",children:"Index incomplete!"})})})]})}function C(){let{query:e,isReady:s}=(0,_.useRouter)(),{userHandle:a,instanceHandle:t,isStaging:i}=e,r=(a&&t?"true"===i?"https://".concat(a,".apps.staging.steamship.com/").concat(t,"/").concat(t):"https://".concat(a,".steamship.run/").concat(t,"/").concat(t):null)||"https://jeff-stewart.steamship.run/nepatools-index-01/ask-my-book-chat-api-9fa0539b50d2d9613eb07ffc104a0479";console.log("baseUrl",r);let o=(0,n.jsx)("div",{className:"rounded-md bg-red-50 p-4",children:(0,n.jsx)("div",{className:"flex",children:(0,n.jsxs)("div",{className:"ml-3",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,n.jsx)("p",{children:"Unknown index selected!"})]})})});return(0,n.jsxs)(l.T3,{className:"flex flex-col gap-12 ",children:[(0,n.jsxs)("section",{className:"flex flex-col gap-6 ",children:[(0,n.jsx)(l.xv,{variant:"h1",children:"NEPAchat"}),s&&(0,n.jsx)(T,{dbId:""})]}),(0,n.jsx)("section",{className:"flex flex-col gap-3",children:(0,n.jsxs)("div",{className:"lg",children:[void 0===r&&o,(0,n.jsx)(y,{baseUrl:r})]})})]})}C.Layout=l.Ar;var E=C},4303:function(e){e.exports={loading:"loading-dots_loading__LomzL",spacer:"loading-dots_spacer__nBBvk",blink:"loading-dots_blink__yy72w",loading2:"loading-dots_loading2___zCAu"}}},function(e){e.O(0,[556,980,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);